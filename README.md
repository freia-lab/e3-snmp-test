# e3-snmp

e3 wrapper for the `snmp` module.

# Test Setup - snmp
**/test** contains the sources for the automatic testing of the e3-snmp module.

## Prerequisites
In order to run the test suite, you must install the following:

 * python3

Python >= 3.7 is required.

And the python modules listed in requirements.txt:

You must configure the EPICS environment before running the test suite.
For the e3 environment, this requires you to ``source setE3Env.bash``.

## Test Suite Components

The test setup consists of three main components:

### SNMP simulator

A simulated SNMP agent, using the Python module snmpsim-lextudio [1].

The simulation data was generated by scanning an EMX888 and is located in *data/simdata.snmprec*. The OIDs are translated with MIB module *EMD-MIB*.

Running the test will invoke the snmpsim daemon on the local IP address on port 1024.

### IOC

A test IOC is provided that translates the SNMP OIDs from the SNMP agent simulation.
The following records are defined:


| Record                    | EPICS Type | SNMP OID                                 |
|---------------------------|------------|------------------------------------------|
| TestSnmp:testString_R     | stringin   | EMD-MIB::deviceName.0                    |
| TestSnmp:testInteger_R    | ai         | EMD-MIB::externalSensorCount.0           |
| TestSnmp:testCounter_R    | ai         | EMD-MIB::managedExternalSensorCount.0    |
| TestSnmp:testEnum_R       | ai         | EMD-MIB::externalSensorType.3            |
| TestSnmp:testGauge32_R    | longin     | EMD-MIB::externalSensorDecimalDigits.2   |
| TestSnmp:testString       | stringout  | EMD-MIB::deviceName.0                    |
| TestSnmp:testInteger      | ao         | EMD-MIB::externalSensorCount.0           |
| TestSnmp:testEnum         | ao         | EMD-MIB::externalSensorType.3            |
| TestSnmp:testGauge32      | longout    | EMD-MIB::externalSensorDecimalDigits.2   |


Startup scripts and database files are provided in the
cmd/ and db/ subdirectories.

## Python Test Files
The pytest framework [2] is used to implement the test cases. Individual test cases are provided
as python functions (defs) in [\(test_snmp.py\)](test_snmp.py). Under the hood,
run_iocsh [3] and pyepics [4] are used for communication with the test IOC.

To add a new test case, simply add a new funtion (def) to [\(test_snmp.py\)](test_snmp.py),
ensuring that the function name begins with the prefix ``test_``

## References
[1] https://github.com/lextudio/snmpsim

[2] https://docs.pytest.org/en/stable/

[3] https://gitlab.esss.lu.se/ics-infrastructure/run-iocsh

[4] http://pyepics.github.io/pyepics/
